{"ast":null,"code":"'use strict';\n\nconst Joi = require('joi');\nconst _ = require('lodash');\nconst fs = require('../utils/fs');\nconst error = require('./error');\nconst path = require('path');\nfunction validateSchema(userSchema) {\n  const schema = Joi.array().items({\n    name: Joi.string(),\n    type: Joi.string().valid('module', 'component'),\n    disable: Joi.boolean(),\n    modules: Joi.array().items({\n      name: Joi.string()\n    }).when('type', {\n      is: 'component',\n      then: Joi.optional(),\n      otherwise: Joi.forbidden()\n    })\n  });\n  const result = Joi.validate(userSchema, schema);\n  if (result.error) {\n    result.error.message = error({\n      location: 'arc loader - specification schema validator',\n      description: result.error.message\n    });\n    throw result.error;\n  } else {\n    return true;\n  }\n}\nfunction validateContent(userSchema, loadedSchema) {\n  _.forEach(userSchema, schemaItem => {\n    if (schemaItem.disable) {\n      return;\n    }\n    const existingSchemaItem = _.find(loadedSchema, {\n      name: schemaItem.name\n    });\n    if (!existingSchemaItem) {\n      // throw error\n      throw new Error(`item not found ${schemaItem.name}`);\n    }\n    if (!_.isEmpty(schemaItem.modules)) {\n      if (_.isEmpty(existingSchemaItem.modules)) {\n        throw new Error(`${existingSchemaItem.name} does not have modules`);\n      }\n      _.forEach(schemaItem.modules, subSchemaItem => {\n        const existingSubSchemaItem = _.find(existingSchemaItem.modules, {\n          name: subSchemaItem.name\n        });\n        if (!existingSubSchemaItem) {\n          throw new Error(`item not found ${subSchemaItem.name}`);\n        }\n      });\n    }\n  });\n  return true;\n}\nasync function loadSchema(location, spec) {\n  const content = await fs.dirContent(location);\n  let schema = [];\n  _.forEach(content.files, file => {\n    const relatedSpec = _.find(spec, {\n      name: file\n    });\n    if (!relatedSpec || !relatedSpec.disable) {\n      schema.push({\n        name: file,\n        type: 'module'\n      });\n    }\n  });\n  const promiseArray = [];\n  _.forEach(content.folders, folder => {\n    const relatedSpec = _.find(spec, {\n      name: folder\n    });\n    if (!relatedSpec || !relatedSpec.disable) {\n      promiseArray.push(_componentSchema(location, folder, spec));\n    }\n  });\n  const components = await Promise.all(promiseArray);\n  schema = _.union(schema, components);\n  return schema;\n}\nasync function _componentSchema(location, folder, spec) {\n  const content = await fs.dirContent(path.join(location, folder));\n  const foundModules = _.filter(content.files, c => {\n    const relatedSpec = _.find(spec, {\n      name: folder\n    });\n    if (!relatedSpec || !relatedSpec.disable) {\n      return c;\n    }\n  });\n  const component = {\n    name: folder,\n    type: 'component',\n    modules: []\n  };\n  component.modules = _.map(foundModules, file => {\n    return {\n      name: file\n    };\n  });\n  return component;\n}\nmodule.exports = {\n  loadSchema,\n  validateSchema,\n  validateContent\n};","map":{"version":3,"names":["Joi","require","_","fs","error","path","validateSchema","userSchema","schema","array","items","name","string","type","valid","disable","boolean","modules","when","is","then","optional","otherwise","forbidden","result","validate","message","location","description","validateContent","loadedSchema","forEach","schemaItem","existingSchemaItem","find","Error","isEmpty","subSchemaItem","existingSubSchemaItem","loadSchema","spec","content","dirContent","files","file","relatedSpec","push","promiseArray","folders","folder","_componentSchema","components","Promise","all","union","join","foundModules","filter","c","component","map","module","exports"],"sources":["/Users/mariovicky/Skripsi_OpenLayers/node_modules/arc.js/lib/specification.js"],"sourcesContent":["'use strict';\n\nconst Joi = require('joi');\nconst _ = require('lodash');\nconst fs = require('../utils/fs');\nconst error = require('./error');\nconst path = require('path');\n\nfunction validateSchema (userSchema) {\n  const schema = Joi.array().items({\n    name: Joi.string(),\n    type: Joi.string().valid('module', 'component'),\n    disable: Joi.boolean(),\n    modules: Joi.array()\n      .items({ name: Joi.string() })\n      .when('type', {\n        is: 'component',\n        then: Joi.optional(),\n        otherwise: Joi.forbidden()\n      })\n  });\n\n  const result = Joi.validate(userSchema, schema);\n\n  if (result.error) {\n    result.error.message = error({\n      location: 'arc loader - specification schema validator',\n      description: result.error.message\n    });\n    throw result.error;\n  }\n  else {\n    return true;\n  }\n}\n\nfunction validateContent (userSchema, loadedSchema) {\n  _.forEach(userSchema, (schemaItem) => {\n\n    if (schemaItem.disable) {\n      return;\n    }\n\n    const existingSchemaItem = _.find(loadedSchema, { name: schemaItem.name });\n\n    if (!existingSchemaItem) {\n      // throw error\n      throw new Error(`item not found ${schemaItem.name}`);\n    }\n\n    if (!_.isEmpty(schemaItem.modules)) {\n      if (_.isEmpty(existingSchemaItem.modules)) {\n        throw new Error(`${existingSchemaItem.name} does not have modules`);\n      }\n\n      _.forEach(schemaItem.modules, (subSchemaItem) => {\n        const existingSubSchemaItem = _.find(existingSchemaItem.modules, { name: subSchemaItem.name });\n\n        if (!existingSubSchemaItem) {\n          throw new Error(`item not found ${subSchemaItem.name}`);\n        }\n      });\n    }\n  });\n  return true;\n}\n\nasync function loadSchema (location, spec) {\n\n  const content = await fs.dirContent(location);\n\n  let schema = [];\n\n  _.forEach(content.files, (file) => {\n    const relatedSpec = _.find(spec, { name: file });\n    if (!relatedSpec || !relatedSpec.disable) {\n      schema.push({ name: file, type: 'module' });\n    }\n  });\n\n  const promiseArray = [];\n  _.forEach(content.folders, (folder) => {\n    const relatedSpec = _.find(spec, { name: folder });\n    if (!relatedSpec || !relatedSpec.disable) {\n      promiseArray.push(_componentSchema(location, folder, spec));\n    }\n  });\n\n  const components = await Promise.all(promiseArray);\n\n  schema = _.union(schema, components);\n\n  return schema;\n}\n\nasync function _componentSchema (location, folder, spec) {\n\n  const content = await fs.dirContent(path.join(location, folder));\n\n  const foundModules = _.filter(content.files, (c) => {\n    const relatedSpec = _.find(spec, { name: folder });\n    if (!relatedSpec || !relatedSpec.disable) {\n      return c;\n    }\n  });\n\n  const component = {\n    name: folder,\n    type: 'component',\n    modules: []\n  };\n\n  component.modules = _.map(foundModules, (file) => {\n    return { name: file };\n  });\n\n  return component;\n}\n\nmodule.exports = {\n  loadSchema,\n  validateSchema,\n  validateContent\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}