{"ast":null,"code":"/**\n * @module ol/render/canvas\n */\nimport BaseObject from '../Object.js';\nimport EventTarget from '../events/Target.js';\nimport { WORKER_OFFSCREEN_CANVAS } from '../has.js';\nimport { clear } from '../obj.js';\nimport { createCanvasContext2D } from '../dom.js';\nimport { getFontParameters } from '../css.js';\nimport { toString } from '../transform.js';\n/**\n * @typedef {Object} FillState\n * @property {import(\"../colorlike.js\").ColorLike} fillStyle\n */\n/**\n * @typedef Label\n * @property {number} width\n * @property {number} height\n * @property {Array<string|number>} contextInstructions\n */\n/**\n * @typedef {Object} FillStrokeState\n * @property {import(\"../colorlike.js\").ColorLike} [currentFillStyle]\n * @property {import(\"../colorlike.js\").ColorLike} [currentStrokeStyle]\n * @property {CanvasLineCap} [currentLineCap]\n * @property {Array<number>} currentLineDash\n * @property {number} [currentLineDashOffset]\n * @property {CanvasLineJoin} [currentLineJoin]\n * @property {number} [currentLineWidth]\n * @property {number} [currentMiterLimit]\n * @property {number} [lastStroke]\n * @property {import(\"../colorlike.js\").ColorLike} [fillStyle]\n * @property {import(\"../colorlike.js\").ColorLike} [strokeStyle]\n * @property {CanvasLineCap} [lineCap]\n * @property {Array<number>} lineDash\n * @property {number} [lineDashOffset]\n * @property {CanvasLineJoin} [lineJoin]\n * @property {number} [lineWidth]\n * @property {number} [miterLimit]\n */\n/**\n * @typedef {Object} StrokeState\n * @property {CanvasLineCap} lineCap\n * @property {Array<number>} lineDash\n * @property {number} lineDashOffset\n * @property {CanvasLineJoin} lineJoin\n * @property {number} lineWidth\n * @property {number} miterLimit\n * @property {import(\"../colorlike.js\").ColorLike} strokeStyle\n */\n/**\n * @typedef {Object} TextState\n * @property {string} font\n * @property {string} [textAlign]\n * @property {string} textBaseline\n * @property {string} [placement]\n * @property {number} [maxAngle]\n * @property {boolean} [overflow]\n * @property {import(\"../style/Fill.js\").default} [backgroundFill]\n * @property {import(\"../style/Stroke.js\").default} [backgroundStroke]\n * @property {import(\"../size.js\").Size} [scale]\n * @property {Array<number>} [padding]\n */\n/**\n * Container for decluttered replay instructions that need to be rendered or\n * omitted together, i.e. when styles render both an image and text, or for the\n * characters that form text along lines. The basic elements of this array are\n * `[minX, minY, maxX, maxY, count]`, where the first four entries are the\n * rendered extent of the group in pixel space. `count` is the number of styles\n * in the group, i.e. 2 when an image and a text are grouped, or 1 otherwise.\n * In addition to these four elements, declutter instruction arrays (i.e. the\n * arguments to {@link module:ol/render/canvas~drawImage} are appended to the array.\n * @typedef {Array<*>} DeclutterGroup\n */\n/**\n * Declutter groups for support of multi geometries.\n * @typedef {Array<DeclutterGroup>} DeclutterGroups\n */\n/**\n * @const\n * @type {string}\n */\nexport var defaultFont = '10px sans-serif';\n/**\n * @const\n * @type {import(\"../colorlike.js\").ColorLike}\n */\nexport var defaultFillStyle = '#000';\n/**\n * @const\n * @type {CanvasLineCap}\n */\nexport var defaultLineCap = 'round';\n/**\n * @const\n * @type {Array<number>}\n */\nexport var defaultLineDash = [];\n/**\n * @const\n * @type {number}\n */\nexport var defaultLineDashOffset = 0;\n/**\n * @const\n * @type {CanvasLineJoin}\n */\nexport var defaultLineJoin = 'round';\n/**\n * @const\n * @type {number}\n */\nexport var defaultMiterLimit = 10;\n/**\n * @const\n * @type {import(\"../colorlike.js\").ColorLike}\n */\nexport var defaultStrokeStyle = '#000';\n/**\n * @const\n * @type {string}\n */\nexport var defaultTextAlign = 'center';\n/**\n * @const\n * @type {string}\n */\nexport var defaultTextBaseline = 'middle';\n/**\n * @const\n * @type {Array<number>}\n */\nexport var defaultPadding = [0, 0, 0, 0];\n/**\n * @const\n * @type {number}\n */\nexport var defaultLineWidth = 1;\n/**\n * @type {BaseObject}\n */\nexport var checkedFonts = new BaseObject();\n/**\n * The label cache for text rendering. To change the default cache size of 2048\n * entries, use {@link module:ol/structs/LRUCache#setSize}.\n * Deprecated - there is no label cache any more.\n * @type {?}\n * @api\n * @deprecated\n */\nexport var labelCache = new EventTarget();\nlabelCache.setSize = function () {\n  console.warn('labelCache is deprecated.'); //eslint-disable-line\n};\n/**\n * @type {CanvasRenderingContext2D}\n */\nvar measureContext = null;\n/**\n * @type {string}\n */\nvar measureFont;\n/**\n * @type {!Object<string, number>}\n */\nexport var textHeights = {};\n/**\n * Clears the label cache when a font becomes available.\n * @param {string} fontSpec CSS font spec.\n */\nexport var registerFont = function () {\n  var retries = 100;\n  var size = '32px ';\n  var referenceFonts = ['monospace', 'serif'];\n  var len = referenceFonts.length;\n  var text = 'wmytzilWMYTZIL@#/&?$%10\\uF013';\n  var interval, referenceWidth;\n  /**\n   * @param {string} fontStyle Css font-style\n   * @param {string} fontWeight Css font-weight\n   * @param {*} fontFamily Css font-family\n   * @return {boolean} Font with style and weight is available\n   */\n  function isAvailable(fontStyle, fontWeight, fontFamily) {\n    var available = true;\n    for (var i = 0; i < len; ++i) {\n      var referenceFont = referenceFonts[i];\n      referenceWidth = measureTextWidth(fontStyle + ' ' + fontWeight + ' ' + size + referenceFont, text);\n      if (fontFamily != referenceFont) {\n        var width = measureTextWidth(fontStyle + ' ' + fontWeight + ' ' + size + fontFamily + ',' + referenceFont, text);\n        // If width and referenceWidth are the same, then the fallback was used\n        // instead of the font we wanted, so the font is not available.\n        available = available && width != referenceWidth;\n      }\n    }\n    if (available) {\n      return true;\n    }\n    return false;\n  }\n  function check() {\n    var done = true;\n    var fonts = checkedFonts.getKeys();\n    for (var i = 0, ii = fonts.length; i < ii; ++i) {\n      var font = fonts[i];\n      if (checkedFonts.get(font) < retries) {\n        if (isAvailable.apply(this, font.split('\\n'))) {\n          clear(textHeights);\n          // Make sure that loaded fonts are picked up by Safari\n          measureContext = null;\n          measureFont = undefined;\n          checkedFonts.set(font, retries);\n        } else {\n          checkedFonts.set(font, checkedFonts.get(font) + 1, true);\n          done = false;\n        }\n      }\n    }\n    if (done) {\n      clearInterval(interval);\n      interval = undefined;\n    }\n  }\n  return function (fontSpec) {\n    var font = getFontParameters(fontSpec);\n    if (!font) {\n      return;\n    }\n    var families = font.families;\n    for (var i = 0, ii = families.length; i < ii; ++i) {\n      var family = families[i];\n      var key = font.style + '\\n' + font.weight + '\\n' + family;\n      if (checkedFonts.get(key) === undefined) {\n        checkedFonts.set(key, retries, true);\n        if (!isAvailable(font.style, font.weight, family)) {\n          checkedFonts.set(key, 0, true);\n          if (interval === undefined) {\n            interval = setInterval(check, 32);\n          }\n        }\n      }\n    }\n  };\n}();\n/**\n * @param {string} font Font to use for measuring.\n * @return {import(\"../size.js\").Size} Measurement.\n */\nexport var measureTextHeight = function () {\n  /**\n   * @type {HTMLDivElement}\n   */\n  var div;\n  var heights = textHeights;\n  return function (fontSpec) {\n    var height = heights[fontSpec];\n    if (height == undefined) {\n      if (WORKER_OFFSCREEN_CANVAS) {\n        var font = getFontParameters(fontSpec);\n        var metrics = measureText(fontSpec, 'Žg');\n        var lineHeight = isNaN(Number(font.lineHeight)) ? 1.2 : Number(font.lineHeight);\n        textHeights[fontSpec] = lineHeight * (metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent);\n      } else {\n        if (!div) {\n          div = document.createElement('div');\n          div.innerHTML = 'M';\n          div.style.margin = '0 !important';\n          div.style.padding = '0 !important';\n          div.style.position = 'absolute !important';\n          div.style.left = '-99999px !important';\n        }\n        div.style.font = fontSpec;\n        document.body.appendChild(div);\n        height = div.offsetHeight;\n        heights[fontSpec] = height;\n        document.body.removeChild(div);\n      }\n    }\n    return height;\n  };\n}();\n/**\n * @param {string} font Font.\n * @param {string} text Text.\n * @return {TextMetrics} Text metrics.\n */\nfunction measureText(font, text) {\n  if (!measureContext) {\n    measureContext = createCanvasContext2D(1, 1);\n  }\n  if (font != measureFont) {\n    measureContext.font = font;\n    measureFont = measureContext.font;\n  }\n  return measureContext.measureText(text);\n}\n/**\n * @param {string} font Font.\n * @param {string} text Text.\n * @return {number} Width.\n */\nexport function measureTextWidth(font, text) {\n  return measureText(font, text).width;\n}\n/**\n * Measure text width using a cache.\n * @param {string} font The font.\n * @param {string} text The text to measure.\n * @param {Object<string, number>} cache A lookup of cached widths by text.\n * @returns {number} The text width.\n */\nexport function measureAndCacheTextWidth(font, text, cache) {\n  if (text in cache) {\n    return cache[text];\n  }\n  var width = measureTextWidth(font, text);\n  cache[text] = width;\n  return width;\n}\n/**\n * @param {string} font Font to use for measuring.\n * @param {Array<string>} lines Lines to measure.\n * @param {Array<number>} widths Array will be populated with the widths of\n * each line.\n * @return {number} Width of the whole text.\n */\nexport function measureTextWidths(font, lines, widths) {\n  var numLines = lines.length;\n  var width = 0;\n  for (var i = 0; i < numLines; ++i) {\n    var currentWidth = measureTextWidth(font, lines[i]);\n    width = Math.max(width, currentWidth);\n    widths.push(currentWidth);\n  }\n  return width;\n}\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {number} rotation Rotation.\n * @param {number} offsetX X offset.\n * @param {number} offsetY Y offset.\n */\nexport function rotateAtOffset(context, rotation, offsetX, offsetY) {\n  if (rotation !== 0) {\n    context.translate(offsetX, offsetY);\n    context.rotate(rotation);\n    context.translate(-offsetX, -offsetY);\n  }\n}\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {import(\"../transform.js\").Transform|null} transform Transform.\n * @param {number} opacity Opacity.\n * @param {Label|HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} labelOrImage Label.\n * @param {number} originX Origin X.\n * @param {number} originY Origin Y.\n * @param {number} w Width.\n * @param {number} h Height.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {import(\"../size.js\").Size} scale Scale.\n */\nexport function drawImageOrLabel(context, transform, opacity, labelOrImage, originX, originY, w, h, x, y, scale) {\n  context.save();\n  if (opacity !== 1) {\n    context.globalAlpha *= opacity;\n  }\n  if (transform) {\n    context.setTransform.apply(context, transform);\n  }\n  if ( /** @type {*} */labelOrImage.contextInstructions) {\n    // label\n    context.translate(x, y);\n    context.scale(scale[0], scale[1]);\n    executeLabelInstructions( /** @type {Label} */labelOrImage, context);\n  } else if (scale[0] < 0 || scale[1] < 0) {\n    // flipped image\n    context.translate(x, y);\n    context.scale(scale[0], scale[1]);\n    context.drawImage( /** @type {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} */labelOrImage, originX, originY, w, h, 0, 0, w, h);\n  } else {\n    // if image not flipped translate and scale can be avoided\n    context.drawImage( /** @type {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} */labelOrImage, originX, originY, w, h, x, y, w * scale[0], h * scale[1]);\n  }\n  context.restore();\n}\n/**\n * @param {Label} label Label.\n * @param {CanvasRenderingContext2D} context Context.\n */\nfunction executeLabelInstructions(label, context) {\n  var contextInstructions = label.contextInstructions;\n  for (var i = 0, ii = contextInstructions.length; i < ii; i += 2) {\n    if (Array.isArray(contextInstructions[i + 1])) {\n      context[contextInstructions[i]].apply(context, contextInstructions[i + 1]);\n    } else {\n      context[contextInstructions[i]] = contextInstructions[i + 1];\n    }\n  }\n}\n/**\n * @type {HTMLCanvasElement}\n * @private\n */\nvar createTransformStringCanvas = null;\n/**\n * @param {import(\"../transform.js\").Transform} transform Transform.\n * @return {string} CSS transform.\n */\nexport function createTransformString(transform) {\n  if (WORKER_OFFSCREEN_CANVAS) {\n    return toString(transform);\n  } else {\n    if (!createTransformStringCanvas) {\n      createTransformStringCanvas = createCanvasContext2D(1, 1).canvas;\n    }\n    createTransformStringCanvas.style.transform = toString(transform);\n    return createTransformStringCanvas.style.transform;\n  }\n}","map":{"version":3,"names":["BaseObject","EventTarget","WORKER_OFFSCREEN_CANVAS","clear","createCanvasContext2D","getFontParameters","toString","defaultFont","defaultFillStyle","defaultLineCap","defaultLineDash","defaultLineDashOffset","defaultLineJoin","defaultMiterLimit","defaultStrokeStyle","defaultTextAlign","defaultTextBaseline","defaultPadding","defaultLineWidth","checkedFonts","labelCache","setSize","console","warn","measureContext","measureFont","textHeights","registerFont","retries","size","referenceFonts","len","length","text","interval","referenceWidth","isAvailable","fontStyle","fontWeight","fontFamily","available","i","referenceFont","measureTextWidth","width","check","done","fonts","getKeys","ii","font","get","apply","split","undefined","set","clearInterval","fontSpec","families","family","key","style","weight","setInterval","measureTextHeight","div","heights","height","metrics","measureText","lineHeight","isNaN","Number","actualBoundingBoxAscent","actualBoundingBoxDescent","document","createElement","innerHTML","margin","padding","position","left","body","appendChild","offsetHeight","removeChild","measureAndCacheTextWidth","cache","measureTextWidths","lines","widths","numLines","currentWidth","Math","max","push","rotateAtOffset","context","rotation","offsetX","offsetY","translate","rotate","drawImageOrLabel","transform","opacity","labelOrImage","originX","originY","w","h","x","y","scale","save","globalAlpha","setTransform","contextInstructions","executeLabelInstructions","drawImage","restore","label","Array","isArray","createTransformStringCanvas","createTransformString","canvas"],"sources":["/Users/mariovicky/Skripsi_OpenLayers/node_modules/ol/src/render/canvas.js"],"sourcesContent":["/**\n * @module ol/render/canvas\n */\nimport BaseObject from '../Object.js';\nimport EventTarget from '../events/Target.js';\nimport {WORKER_OFFSCREEN_CANVAS} from '../has.js';\nimport {clear} from '../obj.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {getFontParameters} from '../css.js';\nimport {toString} from '../transform.js';\n\n/**\n * @typedef {Object} FillState\n * @property {import(\"../colorlike.js\").ColorLike} fillStyle\n */\n\n/**\n * @typedef Label\n * @property {number} width\n * @property {number} height\n * @property {Array<string|number>} contextInstructions\n */\n\n/**\n * @typedef {Object} FillStrokeState\n * @property {import(\"../colorlike.js\").ColorLike} [currentFillStyle]\n * @property {import(\"../colorlike.js\").ColorLike} [currentStrokeStyle]\n * @property {CanvasLineCap} [currentLineCap]\n * @property {Array<number>} currentLineDash\n * @property {number} [currentLineDashOffset]\n * @property {CanvasLineJoin} [currentLineJoin]\n * @property {number} [currentLineWidth]\n * @property {number} [currentMiterLimit]\n * @property {number} [lastStroke]\n * @property {import(\"../colorlike.js\").ColorLike} [fillStyle]\n * @property {import(\"../colorlike.js\").ColorLike} [strokeStyle]\n * @property {CanvasLineCap} [lineCap]\n * @property {Array<number>} lineDash\n * @property {number} [lineDashOffset]\n * @property {CanvasLineJoin} [lineJoin]\n * @property {number} [lineWidth]\n * @property {number} [miterLimit]\n */\n\n/**\n * @typedef {Object} StrokeState\n * @property {CanvasLineCap} lineCap\n * @property {Array<number>} lineDash\n * @property {number} lineDashOffset\n * @property {CanvasLineJoin} lineJoin\n * @property {number} lineWidth\n * @property {number} miterLimit\n * @property {import(\"../colorlike.js\").ColorLike} strokeStyle\n */\n\n/**\n * @typedef {Object} TextState\n * @property {string} font\n * @property {string} [textAlign]\n * @property {string} textBaseline\n * @property {string} [placement]\n * @property {number} [maxAngle]\n * @property {boolean} [overflow]\n * @property {import(\"../style/Fill.js\").default} [backgroundFill]\n * @property {import(\"../style/Stroke.js\").default} [backgroundStroke]\n * @property {import(\"../size.js\").Size} [scale]\n * @property {Array<number>} [padding]\n */\n\n/**\n * Container for decluttered replay instructions that need to be rendered or\n * omitted together, i.e. when styles render both an image and text, or for the\n * characters that form text along lines. The basic elements of this array are\n * `[minX, minY, maxX, maxY, count]`, where the first four entries are the\n * rendered extent of the group in pixel space. `count` is the number of styles\n * in the group, i.e. 2 when an image and a text are grouped, or 1 otherwise.\n * In addition to these four elements, declutter instruction arrays (i.e. the\n * arguments to {@link module:ol/render/canvas~drawImage} are appended to the array.\n * @typedef {Array<*>} DeclutterGroup\n */\n\n/**\n * Declutter groups for support of multi geometries.\n * @typedef {Array<DeclutterGroup>} DeclutterGroups\n */\n\n/**\n * @const\n * @type {string}\n */\nexport const defaultFont = '10px sans-serif';\n\n/**\n * @const\n * @type {import(\"../colorlike.js\").ColorLike}\n */\nexport const defaultFillStyle = '#000';\n\n/**\n * @const\n * @type {CanvasLineCap}\n */\nexport const defaultLineCap = 'round';\n\n/**\n * @const\n * @type {Array<number>}\n */\nexport const defaultLineDash = [];\n\n/**\n * @const\n * @type {number}\n */\nexport const defaultLineDashOffset = 0;\n\n/**\n * @const\n * @type {CanvasLineJoin}\n */\nexport const defaultLineJoin = 'round';\n\n/**\n * @const\n * @type {number}\n */\nexport const defaultMiterLimit = 10;\n\n/**\n * @const\n * @type {import(\"../colorlike.js\").ColorLike}\n */\nexport const defaultStrokeStyle = '#000';\n\n/**\n * @const\n * @type {string}\n */\nexport const defaultTextAlign = 'center';\n\n/**\n * @const\n * @type {string}\n */\nexport const defaultTextBaseline = 'middle';\n\n/**\n * @const\n * @type {Array<number>}\n */\nexport const defaultPadding = [0, 0, 0, 0];\n\n/**\n * @const\n * @type {number}\n */\nexport const defaultLineWidth = 1;\n\n/**\n * @type {BaseObject}\n */\nexport const checkedFonts = new BaseObject();\n\n/**\n * The label cache for text rendering. To change the default cache size of 2048\n * entries, use {@link module:ol/structs/LRUCache#setSize}.\n * Deprecated - there is no label cache any more.\n * @type {?}\n * @api\n * @deprecated\n */\nexport const labelCache = new EventTarget();\nlabelCache.setSize = function () {\n  console.warn('labelCache is deprecated.'); //eslint-disable-line\n};\n\n/**\n * @type {CanvasRenderingContext2D}\n */\nlet measureContext = null;\n\n/**\n * @type {string}\n */\nlet measureFont;\n\n/**\n * @type {!Object<string, number>}\n */\nexport const textHeights = {};\n\n/**\n * Clears the label cache when a font becomes available.\n * @param {string} fontSpec CSS font spec.\n */\nexport const registerFont = (function () {\n  const retries = 100;\n  const size = '32px ';\n  const referenceFonts = ['monospace', 'serif'];\n  const len = referenceFonts.length;\n  const text = 'wmytzilWMYTZIL@#/&?$%10\\uF013';\n  let interval, referenceWidth;\n\n  /**\n   * @param {string} fontStyle Css font-style\n   * @param {string} fontWeight Css font-weight\n   * @param {*} fontFamily Css font-family\n   * @return {boolean} Font with style and weight is available\n   */\n  function isAvailable(fontStyle, fontWeight, fontFamily) {\n    let available = true;\n    for (let i = 0; i < len; ++i) {\n      const referenceFont = referenceFonts[i];\n      referenceWidth = measureTextWidth(\n        fontStyle + ' ' + fontWeight + ' ' + size + referenceFont,\n        text\n      );\n      if (fontFamily != referenceFont) {\n        const width = measureTextWidth(\n          fontStyle +\n            ' ' +\n            fontWeight +\n            ' ' +\n            size +\n            fontFamily +\n            ',' +\n            referenceFont,\n          text\n        );\n        // If width and referenceWidth are the same, then the fallback was used\n        // instead of the font we wanted, so the font is not available.\n        available = available && width != referenceWidth;\n      }\n    }\n    if (available) {\n      return true;\n    }\n    return false;\n  }\n\n  function check() {\n    let done = true;\n    const fonts = checkedFonts.getKeys();\n    for (let i = 0, ii = fonts.length; i < ii; ++i) {\n      const font = fonts[i];\n      if (checkedFonts.get(font) < retries) {\n        if (isAvailable.apply(this, font.split('\\n'))) {\n          clear(textHeights);\n          // Make sure that loaded fonts are picked up by Safari\n          measureContext = null;\n          measureFont = undefined;\n          checkedFonts.set(font, retries);\n        } else {\n          checkedFonts.set(font, checkedFonts.get(font) + 1, true);\n          done = false;\n        }\n      }\n    }\n    if (done) {\n      clearInterval(interval);\n      interval = undefined;\n    }\n  }\n\n  return function (fontSpec) {\n    const font = getFontParameters(fontSpec);\n    if (!font) {\n      return;\n    }\n    const families = font.families;\n    for (let i = 0, ii = families.length; i < ii; ++i) {\n      const family = families[i];\n      const key = font.style + '\\n' + font.weight + '\\n' + family;\n      if (checkedFonts.get(key) === undefined) {\n        checkedFonts.set(key, retries, true);\n        if (!isAvailable(font.style, font.weight, family)) {\n          checkedFonts.set(key, 0, true);\n          if (interval === undefined) {\n            interval = setInterval(check, 32);\n          }\n        }\n      }\n    }\n  };\n})();\n\n/**\n * @param {string} font Font to use for measuring.\n * @return {import(\"../size.js\").Size} Measurement.\n */\nexport const measureTextHeight = (function () {\n  /**\n   * @type {HTMLDivElement}\n   */\n  let div;\n  const heights = textHeights;\n  return function (fontSpec) {\n    let height = heights[fontSpec];\n    if (height == undefined) {\n      if (WORKER_OFFSCREEN_CANVAS) {\n        const font = getFontParameters(fontSpec);\n        const metrics = measureText(fontSpec, 'Žg');\n        const lineHeight = isNaN(Number(font.lineHeight))\n          ? 1.2\n          : Number(font.lineHeight);\n        textHeights[fontSpec] =\n          lineHeight *\n          (metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent);\n      } else {\n        if (!div) {\n          div = document.createElement('div');\n          div.innerHTML = 'M';\n          div.style.margin = '0 !important';\n          div.style.padding = '0 !important';\n          div.style.position = 'absolute !important';\n          div.style.left = '-99999px !important';\n        }\n        div.style.font = fontSpec;\n        document.body.appendChild(div);\n        height = div.offsetHeight;\n        heights[fontSpec] = height;\n        document.body.removeChild(div);\n      }\n    }\n    return height;\n  };\n})();\n\n/**\n * @param {string} font Font.\n * @param {string} text Text.\n * @return {TextMetrics} Text metrics.\n */\nfunction measureText(font, text) {\n  if (!measureContext) {\n    measureContext = createCanvasContext2D(1, 1);\n  }\n  if (font != measureFont) {\n    measureContext.font = font;\n    measureFont = measureContext.font;\n  }\n  return measureContext.measureText(text);\n}\n\n/**\n * @param {string} font Font.\n * @param {string} text Text.\n * @return {number} Width.\n */\nexport function measureTextWidth(font, text) {\n  return measureText(font, text).width;\n}\n\n/**\n * Measure text width using a cache.\n * @param {string} font The font.\n * @param {string} text The text to measure.\n * @param {Object<string, number>} cache A lookup of cached widths by text.\n * @returns {number} The text width.\n */\nexport function measureAndCacheTextWidth(font, text, cache) {\n  if (text in cache) {\n    return cache[text];\n  }\n  const width = measureTextWidth(font, text);\n  cache[text] = width;\n  return width;\n}\n\n/**\n * @param {string} font Font to use for measuring.\n * @param {Array<string>} lines Lines to measure.\n * @param {Array<number>} widths Array will be populated with the widths of\n * each line.\n * @return {number} Width of the whole text.\n */\nexport function measureTextWidths(font, lines, widths) {\n  const numLines = lines.length;\n  let width = 0;\n  for (let i = 0; i < numLines; ++i) {\n    const currentWidth = measureTextWidth(font, lines[i]);\n    width = Math.max(width, currentWidth);\n    widths.push(currentWidth);\n  }\n  return width;\n}\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {number} rotation Rotation.\n * @param {number} offsetX X offset.\n * @param {number} offsetY Y offset.\n */\nexport function rotateAtOffset(context, rotation, offsetX, offsetY) {\n  if (rotation !== 0) {\n    context.translate(offsetX, offsetY);\n    context.rotate(rotation);\n    context.translate(-offsetX, -offsetY);\n  }\n}\n\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {import(\"../transform.js\").Transform|null} transform Transform.\n * @param {number} opacity Opacity.\n * @param {Label|HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} labelOrImage Label.\n * @param {number} originX Origin X.\n * @param {number} originY Origin Y.\n * @param {number} w Width.\n * @param {number} h Height.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {import(\"../size.js\").Size} scale Scale.\n */\nexport function drawImageOrLabel(\n  context,\n  transform,\n  opacity,\n  labelOrImage,\n  originX,\n  originY,\n  w,\n  h,\n  x,\n  y,\n  scale\n) {\n  context.save();\n\n  if (opacity !== 1) {\n    context.globalAlpha *= opacity;\n  }\n  if (transform) {\n    context.setTransform.apply(context, transform);\n  }\n\n  if (/** @type {*} */ (labelOrImage).contextInstructions) {\n    // label\n    context.translate(x, y);\n    context.scale(scale[0], scale[1]);\n    executeLabelInstructions(/** @type {Label} */ (labelOrImage), context);\n  } else if (scale[0] < 0 || scale[1] < 0) {\n    // flipped image\n    context.translate(x, y);\n    context.scale(scale[0], scale[1]);\n    context.drawImage(\n      /** @type {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} */ (labelOrImage),\n      originX,\n      originY,\n      w,\n      h,\n      0,\n      0,\n      w,\n      h\n    );\n  } else {\n    // if image not flipped translate and scale can be avoided\n    context.drawImage(\n      /** @type {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} */ (labelOrImage),\n      originX,\n      originY,\n      w,\n      h,\n      x,\n      y,\n      w * scale[0],\n      h * scale[1]\n    );\n  }\n\n  context.restore();\n}\n\n/**\n * @param {Label} label Label.\n * @param {CanvasRenderingContext2D} context Context.\n */\nfunction executeLabelInstructions(label, context) {\n  const contextInstructions = label.contextInstructions;\n  for (let i = 0, ii = contextInstructions.length; i < ii; i += 2) {\n    if (Array.isArray(contextInstructions[i + 1])) {\n      context[contextInstructions[i]].apply(\n        context,\n        contextInstructions[i + 1]\n      );\n    } else {\n      context[contextInstructions[i]] = contextInstructions[i + 1];\n    }\n  }\n}\n\n/**\n * @type {HTMLCanvasElement}\n * @private\n */\nlet createTransformStringCanvas = null;\n\n/**\n * @param {import(\"../transform.js\").Transform} transform Transform.\n * @return {string} CSS transform.\n */\nexport function createTransformString(transform) {\n  if (WORKER_OFFSCREEN_CANVAS) {\n    return toString(transform);\n  } else {\n    if (!createTransformStringCanvas) {\n      createTransformStringCanvas = createCanvasContext2D(1, 1).canvas;\n    }\n    createTransformStringCanvas.style.transform = toString(transform);\n    return createTransformStringCanvas.style.transform;\n  }\n}\n"],"mappings":"AAAA;;;AAGA,OAAOA,UAAU,MAAM,cAAc;AACrC,OAAOC,WAAW,MAAM,qBAAqB;AAC7C,SAAQC,uBAAuB,QAAO,WAAW;AACjD,SAAQC,KAAK,QAAO,WAAW;AAC/B,SAAQC,qBAAqB,QAAO,WAAW;AAC/C,SAAQC,iBAAiB,QAAO,WAAW;AAC3C,SAAQC,QAAQ,QAAO,iBAAiB;AAExC;;;;AAKA;;;;;;AAOA;;;;;;;;;;;;;;;;;;;;AAqBA;;;;;;;;;;AAWA;;;;;;;;;;;;;AAcA;;;;;;;;;;;AAYA;;;;AAKA;;;;AAIA,OAAO,IAAMC,WAAW,GAAG,iBAAiB;AAE5C;;;;AAIA,OAAO,IAAMC,gBAAgB,GAAG,MAAM;AAEtC;;;;AAIA,OAAO,IAAMC,cAAc,GAAG,OAAO;AAErC;;;;AAIA,OAAO,IAAMC,eAAe,GAAG,EAAE;AAEjC;;;;AAIA,OAAO,IAAMC,qBAAqB,GAAG,CAAC;AAEtC;;;;AAIA,OAAO,IAAMC,eAAe,GAAG,OAAO;AAEtC;;;;AAIA,OAAO,IAAMC,iBAAiB,GAAG,EAAE;AAEnC;;;;AAIA,OAAO,IAAMC,kBAAkB,GAAG,MAAM;AAExC;;;;AAIA,OAAO,IAAMC,gBAAgB,GAAG,QAAQ;AAExC;;;;AAIA,OAAO,IAAMC,mBAAmB,GAAG,QAAQ;AAE3C;;;;AAIA,OAAO,IAAMC,cAAc,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAE1C;;;;AAIA,OAAO,IAAMC,gBAAgB,GAAG,CAAC;AAEjC;;;AAGA,OAAO,IAAMC,YAAY,GAAG,IAAInB,UAAU,EAAE;AAE5C;;;;;;;;AAQA,OAAO,IAAMoB,UAAU,GAAG,IAAInB,WAAW,EAAE;AAC3CmB,UAAU,CAACC,OAAO,GAAG;EACnBC,OAAO,CAACC,IAAI,CAAC,2BAA2B,CAAC,CAAC,CAAC;AAC7C,CAAC;AAED;;;AAGA,IAAIC,cAAc,GAAG,IAAI;AAEzB;;;AAGA,IAAIC,WAAW;AAEf;;;AAGA,OAAO,IAAMC,WAAW,GAAG,EAAE;AAE7B;;;;AAIA,OAAO,IAAMC,YAAY,GAAI;EAC3B,IAAMC,OAAO,GAAG,GAAG;EACnB,IAAMC,IAAI,GAAG,OAAO;EACpB,IAAMC,cAAc,GAAG,CAAC,WAAW,EAAE,OAAO,CAAC;EAC7C,IAAMC,GAAG,GAAGD,cAAc,CAACE,MAAM;EACjC,IAAMC,IAAI,GAAG,+BAA+B;EAC5C,IAAIC,QAAQ,EAAEC,cAAc;EAE5B;;;;;;EAMA,SAASC,WAAWA,CAACC,SAAS,EAAEC,UAAU,EAAEC,UAAU;IACpD,IAAIC,SAAS,GAAG,IAAI;IACpB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGV,GAAG,EAAE,EAAEU,CAAC,EAAE;MAC5B,IAAMC,aAAa,GAAGZ,cAAc,CAACW,CAAC,CAAC;MACvCN,cAAc,GAAGQ,gBAAgB,CAC/BN,SAAS,GAAG,GAAG,GAAGC,UAAU,GAAG,GAAG,GAAGT,IAAI,GAAGa,aAAa,EACzDT,IAAI,CACL;MACD,IAAIM,UAAU,IAAIG,aAAa,EAAE;QAC/B,IAAME,KAAK,GAAGD,gBAAgB,CAC5BN,SAAS,GACP,GAAG,GACHC,UAAU,GACV,GAAG,GACHT,IAAI,GACJU,UAAU,GACV,GAAG,GACHG,aAAa,EACfT,IAAI,CACL;QACD;QACA;QACAO,SAAS,GAAGA,SAAS,IAAII,KAAK,IAAIT,cAAc;;;IAGpD,IAAIK,SAAS,EAAE;MACb,OAAO,IAAI;;IAEb,OAAO,KAAK;EACd;EAEA,SAASK,KAAKA,CAAA;IACZ,IAAIC,IAAI,GAAG,IAAI;IACf,IAAMC,KAAK,GAAG5B,YAAY,CAAC6B,OAAO,EAAE;IACpC,KAAK,IAAIP,CAAC,GAAG,CAAC,EAAEQ,EAAE,GAAGF,KAAK,CAACf,MAAM,EAAES,CAAC,GAAGQ,EAAE,EAAE,EAAER,CAAC,EAAE;MAC9C,IAAMS,IAAI,GAAGH,KAAK,CAACN,CAAC,CAAC;MACrB,IAAItB,YAAY,CAACgC,GAAG,CAACD,IAAI,CAAC,GAAGtB,OAAO,EAAE;QACpC,IAAIQ,WAAW,CAACgB,KAAK,CAAC,IAAI,EAAEF,IAAI,CAACG,KAAK,CAAC,IAAI,CAAC,CAAC,EAAE;UAC7ClD,KAAK,CAACuB,WAAW,CAAC;UAClB;UACAF,cAAc,GAAG,IAAI;UACrBC,WAAW,GAAG6B,SAAS;UACvBnC,YAAY,CAACoC,GAAG,CAACL,IAAI,EAAEtB,OAAO,CAAC;SAChC,MAAM;UACLT,YAAY,CAACoC,GAAG,CAACL,IAAI,EAAE/B,YAAY,CAACgC,GAAG,CAACD,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC;UACxDJ,IAAI,GAAG,KAAK;;;;IAIlB,IAAIA,IAAI,EAAE;MACRU,aAAa,CAACtB,QAAQ,CAAC;MACvBA,QAAQ,GAAGoB,SAAS;;EAExB;EAEA,OAAO,UAAUG,QAAQ;IACvB,IAAMP,IAAI,GAAG7C,iBAAiB,CAACoD,QAAQ,CAAC;IACxC,IAAI,CAACP,IAAI,EAAE;MACT;;IAEF,IAAMQ,QAAQ,GAAGR,IAAI,CAACQ,QAAQ;IAC9B,KAAK,IAAIjB,CAAC,GAAG,CAAC,EAAEQ,EAAE,GAAGS,QAAQ,CAAC1B,MAAM,EAAES,CAAC,GAAGQ,EAAE,EAAE,EAAER,CAAC,EAAE;MACjD,IAAMkB,MAAM,GAAGD,QAAQ,CAACjB,CAAC,CAAC;MAC1B,IAAMmB,GAAG,GAAGV,IAAI,CAACW,KAAK,GAAG,IAAI,GAAGX,IAAI,CAACY,MAAM,GAAG,IAAI,GAAGH,MAAM;MAC3D,IAAIxC,YAAY,CAACgC,GAAG,CAACS,GAAG,CAAC,KAAKN,SAAS,EAAE;QACvCnC,YAAY,CAACoC,GAAG,CAACK,GAAG,EAAEhC,OAAO,EAAE,IAAI,CAAC;QACpC,IAAI,CAACQ,WAAW,CAACc,IAAI,CAACW,KAAK,EAAEX,IAAI,CAACY,MAAM,EAAEH,MAAM,CAAC,EAAE;UACjDxC,YAAY,CAACoC,GAAG,CAACK,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC;UAC9B,IAAI1B,QAAQ,KAAKoB,SAAS,EAAE;YAC1BpB,QAAQ,GAAG6B,WAAW,CAAClB,KAAK,EAAE,EAAE,CAAC;;;;;EAK3C,CAAC;AACH,CAAC,CAAC,CAAE;AAEJ;;;;AAIA,OAAO,IAAMmB,iBAAiB,GAAI;EAChC;;;EAGA,IAAIC,GAAG;EACP,IAAMC,OAAO,GAAGxC,WAAW;EAC3B,OAAO,UAAU+B,QAAQ;IACvB,IAAIU,MAAM,GAAGD,OAAO,CAACT,QAAQ,CAAC;IAC9B,IAAIU,MAAM,IAAIb,SAAS,EAAE;MACvB,IAAIpD,uBAAuB,EAAE;QAC3B,IAAMgD,IAAI,GAAG7C,iBAAiB,CAACoD,QAAQ,CAAC;QACxC,IAAMW,OAAO,GAAGC,WAAW,CAACZ,QAAQ,EAAE,IAAI,CAAC;QAC3C,IAAMa,UAAU,GAAGC,KAAK,CAACC,MAAM,CAACtB,IAAI,CAACoB,UAAU,CAAC,CAAC,GAC7C,GAAG,GACHE,MAAM,CAACtB,IAAI,CAACoB,UAAU,CAAC;QAC3B5C,WAAW,CAAC+B,QAAQ,CAAC,GACnBa,UAAU,IACTF,OAAO,CAACK,uBAAuB,GAAGL,OAAO,CAACM,wBAAwB,CAAC;OACvE,MAAM;QACL,IAAI,CAACT,GAAG,EAAE;UACRA,GAAG,GAAGU,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;UACnCX,GAAG,CAACY,SAAS,GAAG,GAAG;UACnBZ,GAAG,CAACJ,KAAK,CAACiB,MAAM,GAAG,cAAc;UACjCb,GAAG,CAACJ,KAAK,CAACkB,OAAO,GAAG,cAAc;UAClCd,GAAG,CAACJ,KAAK,CAACmB,QAAQ,GAAG,qBAAqB;UAC1Cf,GAAG,CAACJ,KAAK,CAACoB,IAAI,GAAG,qBAAqB;;QAExChB,GAAG,CAACJ,KAAK,CAACX,IAAI,GAAGO,QAAQ;QACzBkB,QAAQ,CAACO,IAAI,CAACC,WAAW,CAAClB,GAAG,CAAC;QAC9BE,MAAM,GAAGF,GAAG,CAACmB,YAAY;QACzBlB,OAAO,CAACT,QAAQ,CAAC,GAAGU,MAAM;QAC1BQ,QAAQ,CAACO,IAAI,CAACG,WAAW,CAACpB,GAAG,CAAC;;;IAGlC,OAAOE,MAAM;EACf,CAAC;AACH,CAAC,CAAC,CAAE;AAEJ;;;;;AAKA,SAASE,WAAWA,CAACnB,IAAI,EAAEjB,IAAI;EAC7B,IAAI,CAACT,cAAc,EAAE;IACnBA,cAAc,GAAGpB,qBAAqB,CAAC,CAAC,EAAE,CAAC,CAAC;;EAE9C,IAAI8C,IAAI,IAAIzB,WAAW,EAAE;IACvBD,cAAc,CAAC0B,IAAI,GAAGA,IAAI;IAC1BzB,WAAW,GAAGD,cAAc,CAAC0B,IAAI;;EAEnC,OAAO1B,cAAc,CAAC6C,WAAW,CAACpC,IAAI,CAAC;AACzC;AAEA;;;;;AAKA,OAAM,SAAUU,gBAAgBA,CAACO,IAAI,EAAEjB,IAAI;EACzC,OAAOoC,WAAW,CAACnB,IAAI,EAAEjB,IAAI,CAAC,CAACW,KAAK;AACtC;AAEA;;;;;;;AAOA,OAAM,SAAU0C,wBAAwBA,CAACpC,IAAI,EAAEjB,IAAI,EAAEsD,KAAK;EACxD,IAAItD,IAAI,IAAIsD,KAAK,EAAE;IACjB,OAAOA,KAAK,CAACtD,IAAI,CAAC;;EAEpB,IAAMW,KAAK,GAAGD,gBAAgB,CAACO,IAAI,EAAEjB,IAAI,CAAC;EAC1CsD,KAAK,CAACtD,IAAI,CAAC,GAAGW,KAAK;EACnB,OAAOA,KAAK;AACd;AAEA;;;;;;;AAOA,OAAM,SAAU4C,iBAAiBA,CAACtC,IAAI,EAAEuC,KAAK,EAAEC,MAAM;EACnD,IAAMC,QAAQ,GAAGF,KAAK,CAACzD,MAAM;EAC7B,IAAIY,KAAK,GAAG,CAAC;EACb,KAAK,IAAIH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGkD,QAAQ,EAAE,EAAElD,CAAC,EAAE;IACjC,IAAMmD,YAAY,GAAGjD,gBAAgB,CAACO,IAAI,EAAEuC,KAAK,CAAChD,CAAC,CAAC,CAAC;IACrDG,KAAK,GAAGiD,IAAI,CAACC,GAAG,CAAClD,KAAK,EAAEgD,YAAY,CAAC;IACrCF,MAAM,CAACK,IAAI,CAACH,YAAY,CAAC;;EAE3B,OAAOhD,KAAK;AACd;AAEA;;;;;;AAMA,OAAM,SAAUoD,cAAcA,CAACC,OAAO,EAAEC,QAAQ,EAAEC,OAAO,EAAEC,OAAO;EAChE,IAAIF,QAAQ,KAAK,CAAC,EAAE;IAClBD,OAAO,CAACI,SAAS,CAACF,OAAO,EAAEC,OAAO,CAAC;IACnCH,OAAO,CAACK,MAAM,CAACJ,QAAQ,CAAC;IACxBD,OAAO,CAACI,SAAS,CAAC,CAACF,OAAO,EAAE,CAACC,OAAO,CAAC;;AAEzC;AAEA;;;;;;;;;;;;;AAaA,OAAM,SAAUG,gBAAgBA,CAC9BN,OAAO,EACPO,SAAS,EACTC,OAAO,EACPC,YAAY,EACZC,OAAO,EACPC,OAAO,EACPC,CAAC,EACDC,CAAC,EACDC,CAAC,EACDC,CAAC,EACDC,KAAK;EAELhB,OAAO,CAACiB,IAAI,EAAE;EAEd,IAAIT,OAAO,KAAK,CAAC,EAAE;IACjBR,OAAO,CAACkB,WAAW,IAAIV,OAAO;;EAEhC,IAAID,SAAS,EAAE;IACbP,OAAO,CAACmB,YAAY,CAAChE,KAAK,CAAC6C,OAAO,EAAEO,SAAS,CAAC;;EAGhD,KAAI,gBAAkBE,YAAY,CAAEW,mBAAmB,EAAE;IACvD;IACApB,OAAO,CAACI,SAAS,CAACU,CAAC,EAAEC,CAAC,CAAC;IACvBf,OAAO,CAACgB,KAAK,CAACA,KAAK,CAAC,CAAC,CAAC,EAAEA,KAAK,CAAC,CAAC,CAAC,CAAC;IACjCK,wBAAwB,EAAC,oBAAsBZ,YAAY,EAAGT,OAAO,CAAC;GACvE,MAAM,IAAIgB,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,IAAIA,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE;IACvC;IACAhB,OAAO,CAACI,SAAS,CAACU,CAAC,EAAEC,CAAC,CAAC;IACvBf,OAAO,CAACgB,KAAK,CAACA,KAAK,CAAC,CAAC,CAAC,EAAEA,KAAK,CAAC,CAAC,CAAC,CAAC;IACjChB,OAAO,CAACsB,SAAS,EACf,kEAAoEb,YAAY,EAChFC,OAAO,EACPC,OAAO,EACPC,CAAC,EACDC,CAAC,EACD,CAAC,EACD,CAAC,EACDD,CAAC,EACDC,CAAC,CACF;GACF,MAAM;IACL;IACAb,OAAO,CAACsB,SAAS,EACf,kEAAoEb,YAAY,EAChFC,OAAO,EACPC,OAAO,EACPC,CAAC,EACDC,CAAC,EACDC,CAAC,EACDC,CAAC,EACDH,CAAC,GAAGI,KAAK,CAAC,CAAC,CAAC,EACZH,CAAC,GAAGG,KAAK,CAAC,CAAC,CAAC,CACb;;EAGHhB,OAAO,CAACuB,OAAO,EAAE;AACnB;AAEA;;;;AAIA,SAASF,wBAAwBA,CAACG,KAAK,EAAExB,OAAO;EAC9C,IAAMoB,mBAAmB,GAAGI,KAAK,CAACJ,mBAAmB;EACrD,KAAK,IAAI5E,CAAC,GAAG,CAAC,EAAEQ,EAAE,GAAGoE,mBAAmB,CAACrF,MAAM,EAAES,CAAC,GAAGQ,EAAE,EAAER,CAAC,IAAI,CAAC,EAAE;IAC/D,IAAIiF,KAAK,CAACC,OAAO,CAACN,mBAAmB,CAAC5E,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE;MAC7CwD,OAAO,CAACoB,mBAAmB,CAAC5E,CAAC,CAAC,CAAC,CAACW,KAAK,CACnC6C,OAAO,EACPoB,mBAAmB,CAAC5E,CAAC,GAAG,CAAC,CAAC,CAC3B;KACF,MAAM;MACLwD,OAAO,CAACoB,mBAAmB,CAAC5E,CAAC,CAAC,CAAC,GAAG4E,mBAAmB,CAAC5E,CAAC,GAAG,CAAC,CAAC;;;AAGlE;AAEA;;;;AAIA,IAAImF,2BAA2B,GAAG,IAAI;AAEtC;;;;AAIA,OAAM,SAAUC,qBAAqBA,CAACrB,SAAS;EAC7C,IAAItG,uBAAuB,EAAE;IAC3B,OAAOI,QAAQ,CAACkG,SAAS,CAAC;GAC3B,MAAM;IACL,IAAI,CAACoB,2BAA2B,EAAE;MAChCA,2BAA2B,GAAGxH,qBAAqB,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC0H,MAAM;;IAElEF,2BAA2B,CAAC/D,KAAK,CAAC2C,SAAS,GAAGlG,QAAQ,CAACkG,SAAS,CAAC;IACjE,OAAOoB,2BAA2B,CAAC/D,KAAK,CAAC2C,SAAS;;AAEtD"},"metadata":{},"sourceType":"module","externalDependencies":[]}